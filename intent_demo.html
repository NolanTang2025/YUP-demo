<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YUP Intent Recognition Demo - Real-time User Intent Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Inter', 'SF Pro Display', Arial, sans-serif;
            background: #0a0e27;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(30, 58, 138, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(15, 23, 42, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(212, 175, 55, 0.03) 0%, transparent 70%);
            min-height: 100vh;
            padding: 32px;
            overflow-x: hidden;
            color: #1e293b;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 255, 255, 0.01) 2px, rgba(255, 255, 255, 0.01) 4px);
            pointer-events: none;
            z-index: 0;
        }

        .demo-container {
            max-width: 1920px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            height: calc(100vh - 64px);
            position: relative;
            z-index: 1;
        }

        /* Left Side: Mobile App Simulation */
        .mobile-app-container {
            background: linear-gradient(145deg, #1a1a1a 0%, #0a0a0a 100%);
            border-radius: 36px;
            padding: 32px;
            box-shadow: 
                0 40px 80px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.12),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .mobile-app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            z-index: 1;
        }
        
        .mobile-app-container::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border-radius: 28px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            pointer-events: none;
        }

        .phone-frame {
            width: 375px;
            height: 812px;
            background: #ffffff;
            border-radius: 44px;
            overflow: hidden;
            position: relative;
            box-shadow: 
                0 25px 70px rgba(0, 0, 0, 0.35),
                0 0 0 10px rgba(0, 0, 0, 0.25),
                0 0 0 14px rgba(0, 0, 0, 0.15),
                inset 0 0 0 1px rgba(0, 0, 0, 0.08),
                inset 0 2px 4px rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            margin-top: 0;
            z-index: 2;
        }
        
        .phone-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 25px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
            display: none; /* Hide notch for cleaner look */
        }

        .phone-status-bar {
            height: 44px;
            background: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.3px;
            margin-top: 0;
            flex-shrink: 0;
        }

        .phone-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            background: #f5f5f5;
            position: relative;
            min-height: 0;
        }
        
        /* Highlight box for interactive elements */
        .interaction-highlight {
            position: absolute;
            pointer-events: none;
            z-index: 9999;
            border: 4px solid #3b82f6;
            border-radius: 12px;
            box-shadow: 
                0 0 0 4px rgba(59, 130, 246, 0.3),
                0 0 0 8px rgba(59, 130, 246, 0.15),
                0 0 30px rgba(59, 130, 246, 0.6),
                inset 0 0 20px rgba(59, 130, 246, 0.1);
            background: rgba(59, 130, 246, 0.05);
            animation: highlightPulse 1.5s ease-in-out infinite;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes highlightPulse {
            0%, 100% {
                border-color: #3b82f6;
                box-shadow: 
                    0 0 0 4px rgba(59, 130, 246, 0.3),
                    0 0 0 8px rgba(59, 130, 246, 0.15),
                    0 0 30px rgba(59, 130, 246, 0.6),
                    inset 0 0 20px rgba(59, 130, 246, 0.1);
            }
            50% {
                border-color: #2563eb;
                box-shadow: 
                    0 0 0 6px rgba(59, 130, 246, 0.4),
                    0 0 0 12px rgba(59, 130, 246, 0.2),
                    0 0 40px rgba(59, 130, 246, 0.7),
                    inset 0 0 20px rgba(59, 130, 246, 0.15);
            }
        }
        
        .interaction-highlight.clicking {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 
                0 0 0 6px rgba(212, 175, 55, 0.4),
                0 0 0 12px rgba(212, 175, 55, 0.2),
                0 0 40px rgba(212, 175, 55, 0.7),
                inset 0 0 20px rgba(212, 175, 55, 0.15);
            animation: highlightClick 0.4s ease-out;
        }
        
        @keyframes highlightClick {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(0.95);
            }
            100% {
                transform: scale(1);
            }
        }

        /* YUP App UI Components */
        .app-header {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #fff;
            padding: 32px 24px 24px;
            padding-top: 60px;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .app-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .credit-card-display {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            border-radius: 24px;
            padding: 28px;
            margin: 24px;
            color: #fff;
            box-shadow: 
                0 20px 40px rgba(30, 58, 138, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .credit-card-display::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .card-number {
            font-size: 24px;
            letter-spacing: 3px;
            margin: 20px 0;
            font-weight: 500;
        }

        .card-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .card-balance {
            font-size: 32px;
            font-weight: 700;
            margin-top: 10px;
        }

        .app-menu {
            background: #ffffff;
            margin: 20px;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 
                0 4px 12px rgba(0,0,0,0.08),
                0 0 0 1px rgba(0,0,0,0.04);
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .menu-item:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: translateX(4px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        .menu-item.active {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            border-color: #0f172a;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.3);
        }

        .menu-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
            flex-shrink: 0;
        }

        .menu-item.active .menu-icon {
            background: rgba(255,255,255,0.15);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }

        .payment-page, .voucher-page, .profile-page {
            display: none;
            padding: 20px;
        }

        .payment-page.active, .voucher-page.active, .profile-page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-form {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            color: #0f172a;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-group input::placeholder {
            color: #94a3b8;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.3);
            letter-spacing: 0.3px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 6px 0;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
            z-index: 100;
            backdrop-filter: blur(10px);
            height: 50px;
            box-sizing: border-box;
            flex-shrink: 0;
            margin-top: auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 4px 20px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.5;
            border-radius: 12px;
        }

        .nav-item:hover {
            opacity: 0.8;
            background: rgba(15, 23, 42, 0.05);
        }

        .nav-item.active {
            opacity: 1;
        }

        .nav-item.active .nav-icon {
            color: #0f172a;
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
            transition: transform 0.2s;
        }

        .nav-label {
            font-size: 10px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .nav-item.active .nav-label {
            color: #0f172a;
            font-weight: 600;
        }

        /* Floating Action Button */
        .floating-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 15px rgba(212,175,55,0.4);
            cursor: pointer;
            z-index: 99;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* Right Side: Intent Analysis Dashboard */
        .intent-dashboard {
            background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 28px;
            padding: 40px;
            box-shadow: 
                0 25px 70px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow-y: auto;
            max-height: calc(100vh - 64px);
            backdrop-filter: blur(20px);
            position: relative;
        }
        
        .intent-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #d4af37 100%);
            border-radius: 28px 28px 0 0;
        }
        
        .intent-dashboard::-webkit-scrollbar {
            width: 8px;
        }
        
        .intent-dashboard::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .intent-dashboard::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .intent-dashboard::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 28px;
            border-bottom: 2px solid #f1f5f9;
            position: relative;
            padding-top: 8px;
        }
        
        .dashboard-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #d4af37 100%);
            border-radius: 2px;
        }

        .dashboard-header h1 {
            color: #0f172a;
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: -0.8px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-header p {
            color: #64748b;
            font-size: 15px;
            font-weight: 500;
            line-height: 1.6;
            letter-spacing: 0.2px;
        }

        .user-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .user-btn {
            padding: 14px 20px;
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            color: #475569;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            min-width: 120px;
            position: relative;
        }

        .user-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .user-btn.active {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            border-color: #0f172a;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.3);
            transform: translateY(-2px);
        }
        
        .user-btn.active .transaction-status {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .intent-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 20px;
            padding: 28px 24px;
            text-align: center;
            border: 1.5px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
            transition: all 0.3s;
        }
        
        .metric-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 
                0 16px 32px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border-color: #cbd5e1;
        }
        
        .metric-card:hover::after {
            opacity: 1;
        }

        .metric-card.high {
            border-color: #10b981;
        }
        
        .metric-card.high::before {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }

        .metric-card.medium {
            border-color: #f59e0b;
        }
        
        .metric-card.medium::before {
            background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
        }

        .metric-card.low {
            border-color: #ef4444;
        }
        
        .metric-card.low::before {
            background: linear-gradient(90deg, #ef4444 0%, #f87171 100%);
        }

        .metric-label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            opacity: 0.8;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 800;
            color: #0f172a;
            letter-spacing: -1.5px;
            font-variant-numeric: tabular-nums;
            line-height: 1.2;
        }

        .intent-type {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 40%, #334155 100%);
            color: #fff;
            border-radius: 24px;
            padding: 32px 28px;
            margin-bottom: 36px;
            text-align: center;
            box-shadow: 
                0 12px 40px rgba(15, 23, 42, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .intent-type::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.15) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        .intent-type::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .intent-type h3 {
            font-size: 18px;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .intent-type .type-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .intent-type .type-description {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.6;
        }

        .journey-timeline {
            background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 36px;
            border: 1.5px solid #e2e8f0;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
        }
        
        .journey-timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #d4af37 100%);
            border-radius: 24px 24px 0 0;
        }

        .journey-timeline h3 {
            color: #0f172a;
            margin-bottom: 24px;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #journeyTimeline {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        #journeyTimeline::-webkit-scrollbar {
            width: 6px;
        }
        
        #journeyTimeline::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        #journeyTimeline::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        #journeyTimeline::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            margin-bottom: 10px;
            background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 14px;
            border-left: 4px solid #3b82f6;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
            cursor: pointer;
        }
        
        .timeline-item:hover {
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            transform: translateX(4px);
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }
        
        .timeline-item:hover::after {
            content: '‚Üí';
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: 700;
            color: #3b82f6;
            opacity: 0.8;
            animation: pointPulse 1s ease-in-out infinite;
        }
        
        @keyframes pointPulse {
            0%, 100% { transform: translateY(-50%) scale(1); opacity: 0.7; }
            50% { transform: translateY(-50%) scale(1.2); opacity: 1; }
        }
        
        .timeline-item:active {
            transform: translateX(2px) scale(0.98);
        }
        
        .timeline-item.clicked {
            animation: clickRipple 0.6s ease-out;
        }
        
        @keyframes clickRipple {
            0% {
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.04),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8),
                    0 0 0 0 rgba(59, 130, 246, 0.6);
            }
            50% {
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.04),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8),
                    0 0 0 20px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.04),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
            }
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #3b82f6;
            border-radius: 14px 0 0 14px;
            transition: all 0.25s;
        }

        .timeline-item.active {
            border-left-color: #d4af37;
            background: linear-gradient(90deg, #fffbeb 0%, #ffffff 100%);
            transform: translateX(6px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(212, 175, 55, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border-left-width: 5px;
        }
        
        .timeline-item.active::before {
            width: 5px;
            background: linear-gradient(180deg, #d4af37 0%, #f4d03f 100%);
        }

        .timeline-item.completed {
            opacity: 0.6;
        }

        .timeline-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 18px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 
                0 4px 8px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
            position: relative;
        }
        
        .timeline-icon::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            opacity: 0.3;
            z-index: -1;
            filter: blur(4px);
        }

        .timeline-item.active .timeline-icon {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            box-shadow: 
                0 6px 12px rgba(212, 175, 55, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .timeline-item.active .timeline-icon::after {
            background: linear-gradient(135deg, #d4af37, #f4d03f);
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-event {
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 6px;
            font-size: 14px;
            letter-spacing: -0.2px;
        }

        .timeline-time {
            font-size: 12px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        /* Pain Point Detection & Solutions */
        .pain-point-alert {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 16px;
            animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            box-shadow: 
                0 10px 25px rgba(239, 68, 68, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .pain-point-alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
        }

        .pain-point-alert.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pain-point-alert h4 {
            font-size: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .pain-point-alert h4::before {
            content: 'ALERT';
            margin-right: 12px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            text-transform: uppercase;
        }
        
        .pain-point-alert p {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.95;
        }

        .solution-card {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: #fff;
            border-radius: 16px;
            padding: 20px 24px;
            margin-top: 16px;
            display: none;
            box-shadow: 
                0 10px 25px rgba(16, 185, 129, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .solution-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
        }

        .solution-card.show {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .solution-card h4 {
            font-size: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .solution-card h4::before {
            content: 'SOLUTION';
            margin-right: 12px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            text-transform: uppercase;
        }

        .solution-list {
            list-style: none;
            padding: 0;
            margin-top: 12px;
        }

        .solution-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            font-size: 14px;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
        }
        
        .solution-list li::before {
            content: '‚Üí';
            margin-right: 10px;
            font-weight: 700;
            opacity: 0.8;
        }

        .solution-list li:last-child {
            border-bottom: none;
        }

        .control-panel {
            background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 24px;
            padding: 28px;
            margin-top: 0;
            margin-bottom: 32px;
            text-align: center;
            border: 1.5px solid #e2e8f0;
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
        }
        
        .control-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #d4af37 100%);
            border-radius: 24px 24px 0 0;
        }
        
        .speed-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 16px;
            border: 1.5px solid #e2e8f0;
        }
        
        .speed-selector label {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            letter-spacing: 0.3px;
        }
        
        .speed-buttons {
            display: flex;
            gap: 8px;
        }
        
        .speed-btn {
            padding: 8px 16px;
            background: #ffffff;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 50px;
            text-align: center;
        }
        
        .speed-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .speed-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #ffffff;
            border-color: #3b82f6;
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .control-btn {
            padding: 14px 28px;
            margin: 0 10px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #fff;
            border: none;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 12px rgba(15, 23, 42, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            letter-spacing: 0.4px;
            position: relative;
            overflow: hidden;
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 20px rgba(15, 23, 42, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        
        .control-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        
        .control-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .control-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            background: #e2e8f0;
            color: #94a3b8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #e2e8f0 0%, #f1f5f9 100%);
            border-radius: 4px;
            margin: 28px 0;
            overflow: hidden;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.06),
                0 1px 2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f172a 0%, #3b82f6 40%, #8b5cf6 60%, #d4af37 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 0 15px rgba(59, 130, 246, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @media (max-width: 1400px) {
            .demo-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .intent-dashboard {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Left Side: Mobile App Simulation -->
        <div class="mobile-app-container">
            <div class="phone-frame">
                <div class="phone-status-bar">
                    <span>9:41</span>
                    <span>YUP</span>
                    <span>üîã 100%</span>
                </div>
                <div class="phone-content" id="phoneContent">
                    <!-- App content will be dynamically loaded -->
                </div>
                <div class="bottom-nav" id="bottomNav">
                    <!-- Bottom navigation will be dynamically loaded -->
                </div>
            </div>
        </div>

        <!-- Right Side: Intent Analysis Dashboard -->
        <div class="intent-dashboard">
            <div class="dashboard-header">
                <h1>Real-time Intent Analysis</h1>
                <p>Advanced AI-powered user intent recognition for credit card industry</p>
            </div>

            <div class="user-selector" id="userSelector">
                <!-- User buttons will be dynamically generated -->
            </div>

            <!-- Control Panel - Moved up for better visibility and priority -->
            <div class="control-panel" style="margin-bottom: 32px;">
                <div class="speed-selector">
                    <label>Playback Speed:</label>
                    <div class="speed-buttons">
                        <button class="speed-btn" onclick="setPlaybackSpeed(0.5)" data-speed="0.5">0.5x</button>
                        <button class="speed-btn active" onclick="setPlaybackSpeed(1)" data-speed="1">1x</button>
                        <button class="speed-btn" onclick="setPlaybackSpeed(1.5)" data-speed="1.5">1.5x</button>
                        <button class="speed-btn" onclick="setPlaybackSpeed(2)" data-speed="2">2x</button>
                        <button class="speed-btn" onclick="setPlaybackSpeed(3)" data-speed="3">3x</button>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <button class="control-btn" onclick="startDemo()" id="startBtn">Start Demo</button>
                <button class="control-btn" onclick="pauseDemo()" id="pauseBtn" disabled>Pause</button>
                <button class="control-btn" onclick="resetDemo()" id="resetBtn">Reset</button>
            </div>

            <div class="intent-metrics" id="intentMetrics">
                <!-- Metrics will be dynamically loaded -->
            </div>

            <div class="intent-type" id="intentType">
                <!-- Intent type will be dynamically loaded -->
            </div>

            <!-- Risk Intent Radar Chart -->
            <div class="section" style="background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%); border-radius: 24px; padding: 32px; margin-bottom: 36px; border: 1.5px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.8); position: relative;">
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #d4af37 100%); border-radius: 24px 24px 0 0;"></div>
                <h3 style="color: #0f172a; margin-bottom: 28px; font-size: 20px; font-weight: 700; letter-spacing: -0.4px; margin-top: 4px;">Risk Intent Radar</h3>
                <div id="riskRadarChart" style="height: 400px;"></div>
                <div style="margin-top: 28px; padding: 24px; background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border-radius: 20px; border: 1.5px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <div style="font-weight: 800; font-size: 22px; color: #0f172a; letter-spacing: -0.6px; margin-bottom: 6px;" id="riskScoreDisplay">Risk Score: 0</div>
                            <div style="font-size: 14px; color: #64748b; font-weight: 600; letter-spacing: 0.2px;" id="riskLevelDisplay">Level: Normal Consultation</div>
                        </div>
                        <div id="riskIndicator" style="width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 800; font-size: 26px; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35), inset 0 1px 0 rgba(255,255,255,0.2); position: relative;">
                            <span style="position: relative; z-index: 1;">0</span>
                            <div style="position: absolute; inset: -4px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #34d399); opacity: 0.3; filter: blur(8px); z-index: 0;"></div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 14px; margin-top: 24px;">
                        <div style="flex: 1; padding: 14px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-radius: 14px; text-align: center; border: 2px solid #10b981; box-shadow: 0 2px 6px rgba(16, 185, 129, 0.15);">
                            <div style="font-size: 11px; color: #065f46; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px;">0-20</div>
                            <div style="font-weight: 800; color: #059669; font-size: 15px; letter-spacing: 0.2px;">Normal</div>
                        </div>
                        <div style="flex: 1; padding: 14px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 14px; text-align: center; border: 2px solid #f59e0b; box-shadow: 0 2px 6px rgba(245, 158, 11, 0.15);">
                            <div style="font-size: 11px; color: #92400e; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px;">20-60</div>
                            <div style="font-weight: 800; color: #d97706; font-size: 15px; letter-spacing: 0.2px;">Potential Risk</div>
                        </div>
                        <div style="flex: 1; padding: 14px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-radius: 14px; text-align: center; border: 2px solid #ef4444; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.15);">
                            <div style="font-size: 11px; color: #991b1b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px;">60-100</div>
                            <div style="font-weight: 800; color: #dc2626; font-size: 15px; letter-spacing: 0.2px;">High Risk</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="journey-timeline">
                <h3>User Journey Timeline</h3>
                <div id="journeyTimeline">
                    <!-- Timeline will be dynamically loaded -->
                </div>
            </div>

            <div class="pain-point-alert" id="painPointAlert">
                <!-- Pain point alerts will be dynamically loaded -->
            </div>

            <div class="solution-card" id="solutionCard">
                <!-- Solutions will be dynamically loaded -->
            </div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script>
        // Embedded user journeys data (to avoid CORS issues when opening file directly)
        window.USER_JOURNEYS_DATA = {"journeys":{"011c40cc5105419293c6a52635546b4a":[{"event_name":"show_live_face_verification_page","time_offset":0.0,"remarks":""},{"event_name":"show_QSPIN_activate_success_pg","time_offset":2.0,"remarks":""},{"event_name":"show_home_page","time_offset":5.0,"remarks":"‰∏ªÈ°µ"},{"event_name":"show_home_task_33d23476a64648a39a57ade1f93d6030","time_offset":6.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":7.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":8.0,"remarks":""},{"event_name":"click_fullpopup_pribtn_3127","time_offset":14.0,"remarks":"ÂÖ®Â±èÂºπÁ™ó"},{"event_name":"show_pay_checkout_page_new_recharge_phone","time_offset":15.0,"remarks":"ËØùË¥πÂÖÖÂÄºÈ°µÈù¢"},{"event_name":"show_home_floaticon_2920","time_offset":19.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187775259","time_offset":28.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_qris_camera_pg","time_offset":44.0,"remarks":"QRÊâ´Á†ÅÈ°µÈù¢"},{"event_name":"show_qr_upload_btn","time_offset":45.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":47.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187775259","time_offset":49.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":51.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742095","time_offset":56.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":60.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742094","time_offset":61.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":70.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187775259","time_offset":72.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":73.0,"remarks":""},{"event_name":"show_home_page","time_offset":5632.0,"remarks":"‰∏ªÈ°µ"},{"event_name":"show_home_task_33d23476a64648a39a57ade1f93d6030","time_offset":5635.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":5637.0,"remarks":""},{"event_name":"show_myvoucher_page","time_offset":5641.0,"remarks":"Âà∏ÂåÖÈ°µ"},{"event_name":"show_voucherusage_pg","time_offset":5658.0,"remarks":""},{"event_name":"click_voucherusage_VoucherPayType.ELECTRICITY_RECHARGE","time_offset":5671.0,"remarks":""},{"event_name":"show_rechargephone_page","time_offset":5672.0,"remarks":""},{"event_name":"click_home_bottomnav_bayar_btn","time_offset":5689.0,"remarks":""},{"event_name":"click_nav_home_btn","time_offset":5691.0,"remarks":""},{"event_name":"show_home_task_33d23476a64648a39a57ade1f93d6030","time_offset":5692.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742095","time_offset":5695.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":5721.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":5722.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742094","time_offset":5723.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":5733.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742095","time_offset":5736.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":5839.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742095","time_offset":6129.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":6134.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187742094","time_offset":6136.0,"remarks":"Âà∏ËØ¶ÊÉÖÁÇπÂáª"},{"event_name":"show_home_floaticon_2920","time_offset":6145.0,"remarks":""},{"event_name":"show_home_page","time_offset":6975.0,"remarks":"‰∏ªÈ°µ"},{"event_name":"show_new_homebanner_A_3209","time_offset":6978.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":6979.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":6980.0,"remarks":""},{"event_name":"show_home_floaticon_2920","time_offset":6981.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_detail_187775259","time_offset":6983.0,"remarks":""},{"event_name":"show_qris_camera_pg","time_offset":6984.0,"remarks":"QRÊâ´Á†ÅÈ°µÈù¢"},{"event_name":"click_qr_upload_btn","time_offset":6987.0,"remarks":""},{"event_name":"show_qr_upload_btn","time_offset":6993.0,"remarks":""},{"event_name":"show_pay_checkout_page_qr","time_offset":6994.0,"remarks":""},{"event_name":"show_pay_checkout_page_new_qr","time_offset":6995.0,"remarks":""},{"event_name":"show_qris_camera_pg","time_offset":7006.0,"remarks":""},{"event_name":"click_qr_upload_btn","time_offset":7007.0,"remarks":""},{"event_name":"show_qr_upload_btn","time_offset":7012.0,"remarks":""},{"event_name":"show_pay_checkout_page_new_qr","time_offset":7013.0,"remarks":"QRÁªìÁÆóÈ°µ"},{"event_name":"click_paymentpage_voucher","time_offset":7066.0,"remarks":"ÁÇπÂáªÂà∏‰ΩøÁî®ËØ¶ÊÉÖÊåâÈíÆ"},{"event_name":"show_cannot_use_voucher_page_0_187742095","time_offset":7068.0,"remarks":""},{"event_name":"show_cannot_use_voucher_page_0_187742095","time_offset":7069.0,"remarks":""},{"event_name":"show_cannot_use_voucher_page_0_187742095","time_offset":7070.0,"remarks":""},{"event_name":"show_cannot_use_voucher_page_0_187742095","time_offset":7071.0,"remarks":""},{"event_name":"show_cannot_use_voucher_page_0_187742095","time_offset":7072.0,"remarks":""},{"event_name":"show_paymentpage_voucher","time_offset":7075.0,"remarks":""},{"event_name":"click_pay_checkout_submit_btn_new_qr","time_offset":7102.0,"remarks":""},{"event_name":"show_paymentpage_voucher","time_offset":7104.0,"remarks":""},{"event_name":"click_pay_checkout_submit_btn_qr","time_offset":7105.0,"remarks":"ÁÇπÂáªÊèê‰∫§"}],"01ef6ac2baf84efe9a762f78aeecbd44":[{"event_name":"show_QSPIN_activate_success_pg","time_offset":0.0,"remarks":""},{"event_name":"show_home_page","time_offset":2.0,"remarks":"‰∏ªÈ°µ"},{"event_name":"show_yup_homepage_producttype_creditcard","time_offset":3.0,"remarks":""},{"event_name":"show_fullpopup_3128","time_offset":7.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":18.0,"remarks":""},{"event_name":"click_fullpopup_pribtn_3128","time_offset":47.0,"remarks":"ÂÖ®Â±èÂºπÁ™ó"},{"event_name":"show_pay_checkout_page_recharge_phone","time_offset":51.0,"remarks":"ËØùË¥πÂÖÖÂÄºÈ°µÈù¢"},{"event_name":"show_pay_checkout_page_new_recharge_phone","time_offset":52.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":60.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":61.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":71.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":72.0,"remarks":""},{"event_name":"show_messagebox_page","time_offset":76.0,"remarks":""},{"event_name":"click_messagebox_message_389144432","time_offset":98.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":102.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":103.0,"remarks":""},{"event_name":"click_specialbanner_2940","time_offset":128.0,"remarks":""},{"event_name":"click_myvoucher_187536623","time_offset":135.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":147.0,"remarks":""},{"event_name":"click_home_task_refresh_btn","time_offset":154.0,"remarks":"‰ªªÂä°Âà∑Êñ∞ÊåâÈíÆ"},{"event_name":"show_home_task_fe07551383224057875feb2b701ce90c","time_offset":155.0,"remarks":""},{"event_name":"click_home_task_refresh_btn","time_offset":156.0,"remarks":""},{"event_name":"click_yup_tab3","time_offset":162.0,"remarks":""},{"event_name":"click_home_bottomnav_transaction_btn","time_offset":166.0,"remarks":"Â∫ïÈÉ®‰∫§ÊòìÊåâÈíÆÁÇπÂáª"},{"event_name":"click_yup_tab3","time_offset":209.0,"remarks":""},{"event_name":"click_home_bottomnav_qris_btn","time_offset":210.0,"remarks":""},{"event_name":"show_qr_upload_btn","time_offset":211.0,"remarks":""},{"event_name":"click_qris_camera_close_btn","time_offset":225.0,"remarks":""},{"event_name":"show_home_voucher_187536624","time_offset":227.0,"remarks":""},{"event_name":"click_nav_home_btn","time_offset":250.0,"remarks":""},{"event_name":"click_nav_home_btn","time_offset":252.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":253.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":255.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":257.0,"remarks":""},{"event_name":"click_home_top_myvoucher_btn","time_offset":261.0,"remarks":"Âà∏ÊåâÈíÆÁÇπÂáª"},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":268.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":270.0,"remarks":""},{"event_name":"click_home_featurehub_cashback_btn","time_offset":275.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":276.0,"remarks":""},{"event_name":"show_homepage_tempolimit_increase_tooltips","time_offset":277.0,"remarks":""},{"event_name":"show_specialbanner_2940","time_offset":292.0,"remarks":""},{"event_name":"show_membership_voucher_187536623","time_offset":332.0,"remarks":""},{"event_name":"show_home_floaticon_2923","time_offset":333.0,"remarks":""},{"event_name":"click_home_bottomnav_profil_btn","time_offset":335.0,"remarks":"Â∫ïÈÉ®ÂØºËà™Ê†è"},{"event_name":"show_profil_todo_login_email_verify","time_offset":337.0,"remarks":""},{"event_name":"click_profil_todo_email_verify","time_offset":344.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":356.0,"remarks":"MGM"},{"event_name":"show_membership_voucher_187536623","time_offset":373.0,"remarks":""},{"event_name":"show_membership_voucher_187536625","time_offset":378.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":389.0,"remarks":""},{"event_name":"show_membership_voucher_187536625","time_offset":390.0,"remarks":""},{"event_name":"show_home_voucher_187536624","time_offset":458.0,"remarks":""},{"event_name":"show_home_voucher_187536626","time_offset":461.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":462.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":465.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":478.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":496.0,"remarks":""},{"event_name":"show_home_todo_card_login_email_verify","time_offset":497.0,"remarks":""},{"event_name":"show_profil_todo_login_email_verify","time_offset":498.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":499.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":500.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":501.0,"remarks":""},{"event_name":"show_profil_todo_login_email_verify","time_offset":502.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":527.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":528.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":531.0,"remarks":""},{"event_name":"click_home_statement_paylater","time_offset":535.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":537.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":538.0,"remarks":""},{"event_name":"click_topnav_yuhuu_btn","time_offset":543.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":545.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":551.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":555.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":556.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":557.0,"remarks":""},{"event_name":"click_home_top_limit_btn","time_offset":559.0,"remarks":"È¢ùÂ∫¶ÊåâÈíÆ"},{"event_name":"show_limit_page_module_cashloan","time_offset":560.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":565.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":567.0,"remarks":""},{"event_name":"click_home_task_ebeb10536f9a469886eb41d5a609ae43","time_offset":580.0,"remarks":""},{"event_name":"show_specialbanner_2940","time_offset":587.0,"remarks":""},{"event_name":"show_yup_homepage_producttype_creditcard","time_offset":588.0,"remarks":""},{"event_name":"show_home_task_fe07551383224057875feb2b701ce90c","time_offset":589.0,"remarks":""},{"event_name":"click_homepage_messagebox","time_offset":592.0,"remarks":""},{"event_name":"show_qris_camera_pg","time_offset":593.0,"remarks":"QRÊâ´Á†ÅÈ°µÈù¢"},{"event_name":"show_qr_upload_btn","time_offset":594.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":603.0,"remarks":""},{"event_name":"show_qr_upload_btn","time_offset":604.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":611.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":612.0,"remarks":""},{"event_name":"click_messagebox_layanan","time_offset":614.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":625.0,"remarks":""},{"event_name":"click_nav_home_btn","time_offset":626.0,"remarks":""},{"event_name":"click_homepage_messagebox","time_offset":628.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":630.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":631.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":632.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":633.0,"remarks":""},{"event_name":"click_home_voucher_all_btn","time_offset":635.0,"remarks":""},{"event_name":"show_specialbanner_2940","time_offset":637.0,"remarks":""},{"event_name":"click_homepage_messagebox","time_offset":638.0,"remarks":""},{"event_name":"show_messagebox_page","time_offset":639.0,"remarks":""},{"event_name":"click_home_page_transaction","time_offset":640.0,"remarks":""},{"event_name":"click_yup_tab3","time_offset":642.0,"remarks":""},{"event_name":"click_home_bottomnav_profil_btn","time_offset":643.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":645.0,"remarks":""},{"event_name":"click_profil_mgm","time_offset":647.0,"remarks":""},{"event_name":"show_specialbanner_2940","time_offset":648.0,"remarks":""},{"event_name":"show_web_mgm_page_41","time_offset":656.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":752.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":753.0,"remarks":""},{"event_name":"click_nav_home_btn","time_offset":754.0,"remarks":""},{"event_name":"show_yup_homepage_producttype_creditcard","time_offset":755.0,"remarks":""},{"event_name":"click_home_bottomnav_profil_btn","time_offset":758.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":759.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":763.0,"remarks":""},{"event_name":"show_membership_voucher_187536624","time_offset":773.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":774.0,"remarks":""},{"event_name":"click_homepage_gvtopup","time_offset":778.0,"remarks":""},{"event_name":"show_homepage_qristopup","time_offset":780.0,"remarks":""},{"event_name":"click_homepage_qristopup_gotogris","time_offset":781.0,"remarks":""},{"event_name":"click_qris_camera_close_btn","time_offset":782.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":783.0,"remarks":""},{"event_name":"click_web_mgm_back_btn","time_offset":784.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":786.0,"remarks":""},{"event_name":"click_topnav_yuhuu_btn","time_offset":788.0,"remarks":""},{"event_name":"show_yupyuhuu_doubleday_entrance","time_offset":789.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":795.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":796.0,"remarks":""},{"event_name":"show_home_voucher_187536626","time_offset":816.0,"remarks":""},{"event_name":"show_new_user_zone_page","time_offset":817.0,"remarks":""},{"event_name":"click_homepage_yupyuhuu_mainicon","time_offset":821.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":822.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":827.0,"remarks":""},{"event_name":"click_new_user_zone_voucher_use_187536623","time_offset":831.0,"remarks":""},{"event_name":"click_voucherusage_VoucherPayType.PHONE_RECHARGE","time_offset":835.0,"remarks":""},{"event_name":"click_voucherusage_VoucherPayType.ELECTRICITY_RECHARGE","time_offset":861.0,"remarks":""},{"event_name":"click_electricity_postpaid","time_offset":863.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":867.0,"remarks":""},{"event_name":"click_homepage_topbar_tasks","time_offset":869.0,"remarks":""},{"event_name":"show_homepage_MAPpoints_bindingbtn","time_offset":882.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":885.0,"remarks":""},{"event_name":"show_home_voucher_187536623","time_offset":1631.0,"remarks":""},{"event_name":"click_home_bottomnav_qris_btn","time_offset":1632.0,"remarks":"QRÊâ´Á†ÅÊåâÈíÆ"},{"event_name":"show_profil_mgm","time_offset":1633.0,"remarks":""},{"event_name":"show_qr_inputamount_pg","time_offset":1664.0,"remarks":""},{"event_name":"click_qr_inputamount_pg_submit_btn","time_offset":1681.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":1682.0,"remarks":""},{"event_name":"show_pay_checkout_page_new_qr","time_offset":1683.0,"remarks":"QRÊîØ‰ªòÁªìÁÆóÈ°µ"},{"event_name":"show_pay_voucher_choose_qr_1","time_offset":1705.0,"remarks":""},{"event_name":"show_paymentpage_voucher","time_offset":1706.0,"remarks":""},{"event_name":"click_qr_inputamount_pg_submit_btn","time_offset":1714.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":1715.0,"remarks":""},{"event_name":"show_pay_voucher_choose_qr_1","time_offset":1718.0,"remarks":""},{"event_name":"show_profil_mgm","time_offset":1730.0,"remarks":""}]},"features":{"011c40cc5105419293c6a52635546b4a":{"exploration_score":0.029850746268656716,"execution_score":0.16417910447761194,"total_events":67,"has_transaction":true,"intent_type":"High Conversion Intent"},"01ef6ac2baf84efe9a762f78aeecbd44":{"exploration_score":0.012903225806451613,"execution_score":0.05806451612903226,"total_events":155,"has_transaction":false,"intent_type":"Exploration Intent"}}};
        
        // Embedded risk scores data
        window.USER_RISK_SCORES_DATA = {"011c40cc5105419293c6a52635546b4a":{"risk_score":59.776119402985074,"risk_factors":{"high_repetition":25.37313432835821,"rapid_switching":0.0,"long_idle":15.0,"failed_attempts":0.0,"unusual_pattern":19.402985074626866,"high_urgency":0.0},"total_events":67,"has_transaction":true},"01ef6ac2baf84efe9a762f78aeecbd44":{"risk_score":67.14151594256947,"risk_factors":{"high_repetition":11.612903225806452,"rapid_switching":0.0,"long_idle":3.6500000000000004,"failed_attempts":30.0,"unusual_pattern":20.0,"high_urgency":1.8786127167630085},"total_events":155,"has_transaction":false}};
        
        // Global state
        let userJourneys = {};
        let userFeatures = {};
        let userRiskScores = {};
        let currentUserIndex = 0;
        let currentEventIndex = 0;
        let isPlaying = false;
        let playInterval = null;
        let currentUserJourney = [];
        let playbackSpeed = 1.0; // Default playback speed (1x)
        let intentMetrics = {
            explorationScore: 0,
            executionScore: 0,
            eventDensity: 0,
            repetitiveScore: 0
        };
        let riskRadarChart = null;

        // Embedded user journeys data (to avoid CORS issues)
        let embeddedUserJourneysData = null;
        
        // Load user journeys and risk scores
        async function loadUserJourneys() {
            try {
                let data = null;
                
                // Try to use embedded data first (if available)
                if (embeddedUserJourneysData) {
                    data = embeddedUserJourneysData;
                    console.log('Using embedded user journeys data');
                } else {
                    // Try to fetch from file
                    try {
                        const response = await fetch('user_journeys.json');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        data = await response.json();
                        console.log('Loaded user_journeys.json from file');
                    } catch (fetchError) {
                        // If fetch fails (CORS issue), try to load embedded data
                        console.warn('Fetch failed (likely CORS issue), checking for embedded data...', fetchError);
                        if (window.USER_JOURNEYS_DATA) {
                            data = window.USER_JOURNEYS_DATA;
                            console.log('Using window.USER_JOURNEYS_DATA');
                        } else {
                            throw new Error('Cannot load user journeys: CORS blocked and no embedded data available. Please use a local server (e.g., python -m http.server) or embed the data in the HTML.');
                        }
                    }
                }
                
                // Handle both old and new JSON structure
                if (data.journeys) {
                    userJourneys = data.journeys;
                    userFeatures = data.features || {};
                } else {
                    userJourneys = data;
                }
                
                // Verify data
                const userIds = Object.keys(userJourneys);
                console.log('User journeys loaded:', userIds.length, 'users');
                userIds.forEach(userId => {
                    const journey = userJourneys[userId];
                    console.log(`  User ${userId.substring(0, 30)}...: ${journey ? journey.length : 0} events`);
                    if (!journey || journey.length === 0) {
                        console.warn(`  WARNING: User ${userId} has no events!`);
                    }
                });
                
                // Load risk scores
                try {
                    const riskResponse = await fetch('user_risk_scores.json');
                    if (riskResponse.ok) {
                        userRiskScores = await riskResponse.json();
                        console.log('Risk scores loaded:', Object.keys(userRiskScores).length);
                    } else {
                        console.warn('Risk scores not found, will calculate dynamically');
                        userRiskScores = {};
                    }
                } catch (error) {
                    // Try embedded risk scores
                    if (window.USER_RISK_SCORES_DATA) {
                        userRiskScores = window.USER_RISK_SCORES_DATA;
                        console.log('Using embedded risk scores data');
                    } else {
                        console.warn('Risk scores not found, will calculate dynamically:', error);
                        userRiskScores = {};
                    }
                }
                
                // Only initialize if we have valid data
                if (userIds.length > 0 && userJourneys[userIds[0]] && userJourneys[userIds[0]].length > 0) {
                    initializeDemo();
                } else {
                    console.error('No valid user journey data found!');
                    alert('Error: No valid user journey data found. Please check user_journeys.json file.');
                }
            } catch (error) {
                console.error('Error loading user journeys:', error);
                console.error('Error details:', error.message, error.stack);
                alert(`Error loading user journeys: ${error.message}\n\nTo fix CORS issue:\n1. Use a local server: python -m http.server 8000\n2. Or embed data directly in HTML`);
                // Don't fallback to sample data - show error instead
            }
        }

        function createSampleData() {
            userJourneys = {
                'user1': [
                    { event_name: 'show_home_page', event_time: '2025-10-10T09:47:48' },
                    { event_name: 'show_home_floaticon_2920', event_time: '2025-10-10T09:47:50' },
                    { event_name: 'show_pay_checkout_page_new_recharge_phone', event_time: '2025-10-10T09:47:58' },
                    { event_name: 'click_new_user_zone_voucher_detail_187775259', event_time: '2025-10-10T09:48:11' },
                ],
                'user2': [
                    { event_name: 'show_home_page', event_time: '2025-10-10T10:15:00' },
                    { event_name: 'show_home_floaticon_2920', event_time: '2025-10-10T10:15:05' },
                ]
            };
            initializeDemo();
        }

        function initializeDemo() {
            const userIds = Object.keys(userJourneys);
            if (userIds.length === 0) {
                console.error('No user IDs found in userJourneys');
                return;
            }
            
            console.log('Initializing demo with users:', userIds);
            
            // Check for user parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const requestedUserId = urlParams.get('user');
            
            // Generate user selector buttons
            renderUserSelector(userIds);
            
            // If a user ID is specified in URL, find and select that user
            if (requestedUserId) {
                const requestedIndex = userIds.indexOf(requestedUserId);
                if (requestedIndex !== -1) {
                    currentUserIndex = requestedIndex;
                    console.log(`User specified in URL: ${requestedUserId}, index: ${requestedIndex}`);
                    // Use switchUser to properly initialize the selected user
                    switchUser(requestedIndex);
                    return; // switchUser will handle the rest
                } else {
                    console.warn(`User ${requestedUserId} not found in userJourneys`);
                }
            }
            
            if (currentUserIndex >= userIds.length) {
                currentUserIndex = 0;
            }
            
            const currentUserId = userIds[currentUserIndex];
            currentUserJourney = userJourneys[currentUserId];
            
            console.log(`Loading user ${currentUserIndex}: ${currentUserId.substring(0, 30)}...`);
            console.log(`  Journey length: ${currentUserJourney ? currentUserJourney.length : 0} events`);
            
            if (!currentUserJourney || currentUserJourney.length === 0) {
                console.error('Current user journey is empty!');
                return;
            }
            
            // Convert time_offset to relative timing for smoother playback
            if (currentUserJourney[0].time_offset !== undefined) {
                // Normalize time offsets to seconds
                const maxTime = Math.max(...currentUserJourney.map(e => e.time_offset || 0));
                currentUserJourney = currentUserJourney.map(e => ({
                    ...e,
                    normalized_time: maxTime > 0 ? (e.time_offset / maxTime) * 100 : 0
                }));
            }
            
            // Show first event or default to home
            if (currentUserJourney.length > 0) {
                renderMobileApp(null, currentUserJourney[0].event_name);
            } else {
                renderMobileApp('home');
            }
            updateIntentMetrics();
            updateRiskRadar();
            renderJourneyTimeline();
            
            console.log(`Demo initialized. Current journey has ${currentUserJourney.length} events.`);
        }
        
        function renderUserSelector(userIds) {
            const selector = document.getElementById('userSelector');
            let html = '';
            
            userIds.forEach((userId, index) => {
                const userFeature = userFeatures[userId] || {};
                const userRisk = userRiskScores[userId] || {};
                const riskScore = userRisk.risk_score || 0;
                const hasTransaction = userFeature.has_transaction || false;
                
                // Determine risk level for badge
                let riskBadge = '';
                if (riskScore >= 60) {
                    riskBadge = '<span style="font-size: 10px; color: #dc2626; margin-left: 6px;">üî¥</span>';
                } else if (riskScore >= 20) {
                    riskBadge = '<span style="font-size: 10px; color: #f59e0b; margin-left: 6px;">üü°</span>';
                } else {
                    riskBadge = '<span style="font-size: 10px; color: #10b981; margin-left: 6px;">üü¢</span>';
                }
                
                const transactionIcon = hasTransaction ? '‚úì' : '‚úó';
                const transactionColor = hasTransaction ? '#10b981' : '#64748b';
                
                html += `
                    <button class="user-btn ${index === currentUserIndex ? 'active' : ''}" 
                            onclick="switchUser(${index})" 
                            title="Risk: ${riskScore.toFixed(1)} | Events: ${userFeature.total_events || 0}">
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="display: flex; align-items: center;">
                                <span>User ${index + 1}</span>
                                ${riskBadge}
                            </div>
                            <div style="font-size: 11px; margin-top: 4px; color: ${transactionColor}; font-weight: 500;">
                                ${transactionIcon} ${hasTransaction ? 'Transaction' : 'No Transaction'}
                            </div>
                        </div>
                    </button>
                `;
            });
            
            selector.innerHTML = html;
        }

        function switchUser(index) {
            currentUserIndex = index;
            currentEventIndex = 0;
            isPlaying = false;
            if (playInterval) {
                clearTimeout(playInterval);
                playInterval = null;
            }
            
            // Update button states
            document.querySelectorAll('.user-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });

            const userIds = Object.keys(userJourneys);
            if (index >= userIds.length) {
                console.warn('User index out of range');
                return;
            }
            
            currentUserJourney = userJourneys[userIds[index]];
            // Convert time_offset to relative timing
            if (currentUserJourney.length > 0 && currentUserJourney[0].time_offset !== undefined) {
                const maxTime = Math.max(...currentUserJourney.map(e => e.time_offset || 0));
                currentUserJourney = currentUserJourney.map(e => ({
                    ...e,
                    normalized_time: maxTime > 0 ? (e.time_offset / maxTime) * 100 : 0
                }));
            }
            // Show first event or default to home
            if (currentUserJourney.length > 0) {
                renderMobileApp(null, currentUserJourney[0].event_name);
            } else {
                renderMobileApp('home');
            }
            updateIntentMetrics();
            updateRiskRadar();
            renderJourneyTimeline();
            resetControls();
        }

        function renderMobileApp(page, eventName = '') {
            const phoneContent = document.getElementById('phoneContent');
            const bottomNav = document.getElementById('bottomNav');
            let html = '';
            let navHtml = '';

            // Determine page from event name if not specified
            if (!page && eventName) {
                const eventLower = eventName.toLowerCase();
                if (eventLower.includes('home') || eventLower.includes('homepage')) {
                    page = 'home';
                } else if (eventLower.includes('payment') || eventLower.includes('checkout') || eventLower.includes('pay') || eventLower.includes('recharge')) {
                    page = 'payment';
                } else if (eventLower.includes('voucher')) {
                    page = 'voucher';
                } else if (eventLower.includes('qr') || eventLower.includes('qris') || eventLower.includes('camera')) {
                    page = 'qr';
                } else if (eventLower.includes('profile') || eventLower.includes('profil')) {
                    page = 'profile';
                } else if (eventLower.includes('activate') || eventLower.includes('success')) {
                    page = 'activation';
                } else if (eventLower.includes('verification') || eventLower.includes('face')) {
                    page = 'verification';
                } else {
                    page = 'home'; // Default
                }
            }

            if (page === 'home') {
                html = `
                    <div class="app-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <h1 style="font-size: 24px; margin: 0;">YUP Credit</h1>
                                <p style="font-size: 14px; opacity: 0.8; margin: 5px 0 0 0;">Welcome back!</p>
                            </div>
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">üîî</div>
                        </div>
                    </div>
                    <div class="credit-card-display">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="font-size: 14px; opacity: 0.9;">Credit Card</div>
                            <div style="font-size: 20px;">üí≥</div>
                        </div>
                        <div class="card-number">**** **** **** 1234</div>
                        <div class="card-info">
                            <div>
                                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Available Credit</div>
                                <div class="card-balance">$5,000</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 5px;">Credit Limit</div>
                                <div style="font-size: 24px; font-weight: 600;">$10,000</div>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 0 20px; margin-top: 20px;">
                        <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="font-weight: 600; font-size: 16px;">New User Zone</div>
                                <div style="font-size: 12px; color: #d4af37; font-weight: 600;">View All ‚Üí</div>
                            </div>
                            <div style="display: flex; gap: 10px; overflow-x: auto;">
                                <div style="min-width: 120px; background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); border-radius: 10px; padding: 15px; text-align: center; color: #fff;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">üéÅ</div>
                                    <div style="font-size: 12px; font-weight: 600;">New User Bonus</div>
                                    <div style="font-size: 10px; opacity: 0.9; margin-top: 3px;">$10 Off</div>
                                </div>
                                <div style="min-width: 120px; background: linear-gradient(135deg, #2c5282 0%, #4a90e2 100%); border-radius: 10px; padding: 15px; text-align: center; color: #fff;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">üé´</div>
                                    <div style="font-size: 12px; font-weight: 600;">Voucher</div>
                                    <div style="font-size: 10px; opacity: 0.9; margin-top: 3px;">Available</div>
                                </div>
                            </div>
                        </div>
                        <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">Quick Actions</div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #0a2540 0%, #1a365d 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 24px;">üí≥</div>
                                    <div style="font-size: 12px; color: #666;">Pay</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 18px; font-weight: 700; color: #0a2540;">PH</div>
                                    <div style="font-size: 12px; color: #666;">Recharge</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 24px;">üì∑</div>
                                    <div style="font-size: 12px; color: #666;">QR Scan</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 24px;">üé´</div>
                                    <div style="font-size: 12px; color: #666;">Voucher</div>
                                </div>
                            </div>
                        </div>
                        <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                            <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">Tasks</div>
                            <div style="display: flex; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px;">
                                <div style="width: 40px; height: 40px; background: #d4af37; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 18px;">‚úì</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 14px;">Complete First Transaction</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 3px;">Get $10 bonus</div>
                                </div>
                                <div style="font-size: 12px; color: #d4af37; font-weight: 600;">Start ‚Üí</div>
                            </div>
                        </div>
                    </div>
                `;
                navHtml = `
                    <div class="nav-item active">
                        <div class="nav-icon">üè†</div>
                        <div class="nav-label">Home</div>
                    </div>
                    <div class="nav-item">
                        <div class="nav-icon">üì∑</div>
                        <div class="nav-label">QR</div>
                    </div>
                    <div class="nav-item">
                        <div class="nav-icon">P</div>
                        <div class="nav-label">Profile</div>
                    </div>
                `;
            } else if (page === 'payment') {
                html = `
                    <div class="app-header">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 20px; cursor: pointer;">‚Üê</div>
                            <div>
                                <h1 style="font-size: 24px; margin: 0;">Payment</h1>
                                <p style="font-size: 14px; opacity: 0.8; margin: 5px 0 0 0;">Phone Recharge</p>
                            </div>
                        </div>
                    </div>
                    <div class="payment-page active">
                        <div style="padding: 0 20px;">
                            <div style="background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">Select Amount</div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                    <div style="padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='#2c5282'; this.style.background='#f0f7ff';" onmouseout="this.style.borderColor='#e0e0e0'; this.style.background='transparent';">
                                        <div style="font-weight: 600; font-size: 18px;">$10</div>
                                    </div>
                                    <div style="padding: 15px; border: 2px solid #2c5282; border-radius: 10px; text-align: center; background: #f0f7ff;">
                                        <div style="font-weight: 600; font-size: 18px;">$20</div>
                                    </div>
                                    <div style="padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; text-align: center; cursor: pointer;" onmouseover="this.style.borderColor='#2c5282'; this.style.background='#f0f7ff';" onmouseout="this.style.borderColor='#e0e0e0'; this.style.background='transparent';">
                                        <div style="font-weight: 600; font-size: 18px;">$50</div>
                                    </div>
                                </div>
                            </div>
                            <div class="payment-form">
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" placeholder="Enter phone number" id="phoneNumber" value="+1 234 567 8900">
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <input type="text" placeholder="Enter amount" id="paymentAmount" value="$20">
                                </div>
                                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="font-size: 18px; margin-right: 10px;">üé´</div>
                                        <div style="font-weight: 600; font-size: 14px;">Available Voucher</div>
                                    </div>
                                    <div style="font-size: 12px; color: #666; margin-left: 28px;">New User Bonus - $10 off</div>
                                </div>
                                <button class="btn-primary" onclick="processPayment()">Continue to Payment</button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (page === 'voucher') {
                html = `
                    <div class="app-header">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 20px; cursor: pointer;">‚Üê</div>
                            <div>
                                <h1 style="font-size: 24px; margin: 0;">Vouchers</h1>
                                <p style="font-size: 14px; opacity: 0.8; margin: 5px 0 0 0;">Available offers</p>
                            </div>
                        </div>
                    </div>
                    <div class="voucher-page active">
                        <div style="padding: 0 20px;">
                            <div style="background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%); border-radius: 15px; padding: 20px; margin-bottom: 20px; color: #fff; box-shadow: 0 4px 15px rgba(212,175,55,0.3);">
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-right: 15px;">üéÅ</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">New User Bonus</div>
                                        <div style="font-size: 14px; opacity: 0.9;">Get $10 off your first transaction</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>
                                        <div style="font-size: 12px; opacity: 0.8;">Valid until</div>
                                        <div style="font-weight: 600;">Dec 31, 2025</div>
                                    </div>
                                    <button style="padding: 10px 20px; background: #fff; color: #d4af37; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;" onclick="useVoucher()">Use Now</button>
                                </div>
                            </div>
                            <div style="background: linear-gradient(135deg, #2c5282 0%, #4a90e2 100%); border-radius: 15px; padding: 20px; margin-bottom: 20px; color: #fff; box-shadow: 0 4px 15px rgba(44,82,130,0.3);">
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-right: 15px;">üé´</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">Membership Voucher</div>
                                        <div style="font-size: 14px; opacity: 0.9;">Special discount for members</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>
                                        <div style="font-size: 12px; opacity: 0.8;">Valid until</div>
                                        <div style="font-weight: 600;">Dec 31, 2025</div>
                                    </div>
                                    <button style="padding: 10px 20px; background: #fff; color: #2c5282; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">View Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (page === 'qr') {
                html = `
                    <div class="app-header">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 20px; cursor: pointer;">‚Üê</div>
                            <div>
                                <h1 style="font-size: 24px; margin: 0;">QR Scan</h1>
                                <p style="font-size: 14px; opacity: 0.8; margin: 5px 0 0 0;">Scan QR code to pay</p>
                            </div>
                        </div>
                    </div>
                    <div style="background: #000; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;">
                        <div style="width: 250px; height: 250px; border: 3px solid #fff; border-radius: 20px; position: relative; margin-bottom: 30px;">
                            <div style="position: absolute; top: -3px; left: -3px; width: 30px; height: 30px; border-top: 4px solid #d4af37; border-left: 4px solid #d4af37; border-radius: 5px 0 0 0;"></div>
                            <div style="position: absolute; top: -3px; right: -3px; width: 30px; height: 30px; border-top: 4px solid #d4af37; border-right: 4px solid #d4af37; border-radius: 0 5px 0 0;"></div>
                            <div style="position: absolute; bottom: -3px; left: -3px; width: 30px; height: 30px; border-bottom: 4px solid #d4af37; border-left: 4px solid #d4af37; border-radius: 0 0 0 5px;"></div>
                            <div style="position: absolute; bottom: -3px; right: -3px; width: 30px; height: 30px; border-bottom: 4px solid #d4af37; border-right: 4px solid #d4af37; border-radius: 0 0 5px 0;"></div>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; background: repeating-linear-gradient(0deg, #333 0px, #333 2px, transparent 2px, transparent 20px), repeating-linear-gradient(90deg, #333 0px, #333 2px, transparent 2px, transparent 20px); opacity: 0.3;"></div>
                        </div>
                        <div style="color: #fff; text-align: center; margin-bottom: 30px;">
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Position QR code in frame</div>
                            <div style="font-size: 14px; opacity: 0.8;">Make sure the QR code is clear and well-lit</div>
                        </div>
                        <div style="display: flex; gap: 20px; position: absolute; bottom: 40px;">
                            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;">üì∑</div>
                            <div style="width: 60px; height: 60px; background: #d4af37; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;">üìÅ</div>
                        </div>
                    </div>
                `;
            } else if (page === 'profile') {
                html = `
                    <div class="app-header">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 20px; cursor: pointer;">‚Üê</div>
                            <div>
                                <h1 style="font-size: 24px; margin: 0;">Profile</h1>
                                <p style="font-size: 14px; opacity: 0.8; margin: 5px 0 0 0;">Account settings</p>
                            </div>
                        </div>
                    </div>
                    <div class="profile-page active">
                        <div style="padding: 0 20px;">
                            <div style="background: #fff; border-radius: 15px; padding: 25px; margin-bottom: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #2c5282 0%, #4a90e2 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700; color: #fff; text-transform: uppercase;">JD</div>
                                <div style="font-weight: 600; font-size: 20px; margin-bottom: 5px;">John Doe</div>
                                <div style="font-size: 14px; color: #666;">Member since Oct 2025</div>
                            </div>
                            <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <div class="menu-item" style="margin-bottom: 0;">
                                    <div class="menu-icon">üìß</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">Email Verification</div>
                                        <div style="font-size: 12px; opacity: 0.7; margin-top: 3px;">Verify your email address</div>
                                    </div>
                                    <div style="font-size: 12px; color: #d4af37; font-weight: 600;">Pending ‚Üí</div>
                                </div>
                            </div>
                            <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <div class="menu-item" style="margin-bottom: 0;">
                                    <div class="menu-icon">üë•</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">Refer Friends</div>
                                        <div style="font-size: 12px; opacity: 0.7; margin-top: 3px;">Invite friends and earn rewards</div>
                                    </div>
                                    <div style="font-size: 12px; color: #2c5282; font-weight: 600;">‚Üí</div>
                                </div>
                            </div>
                            <div style="background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <div class="menu-item" style="margin-bottom: 0;">
                                    <div class="menu-icon">‚öôÔ∏è</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">Settings</div>
                                        <div style="font-size: 12px; opacity: 0.7; margin-top: 3px;">Account and app settings</div>
                                    </div>
                                    <div style="font-size: 12px; color: #2c5282; font-weight: 600;">‚Üí</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                navHtml = `
                    <div class="nav-item">
                        <div class="nav-icon">üè†</div>
                        <div class="nav-label">Home</div>
                    </div>
                    <div class="nav-item">
                        <div class="nav-icon">üì∑</div>
                        <div class="nav-label">QR</div>
                    </div>
                    <div class="nav-item active">
                        <div class="nav-icon">P</div>
                        <div class="nav-label">Profile</div>
                    </div>
                `;
            } else if (page === 'activation') {
                html = `
                    <div style="background: linear-gradient(135deg, #0a2540 0%, #1a365d 100%); height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; color: #fff;">
                        <div style="width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; margin-bottom: 30px; animation: pulse 2s infinite;">‚úì</div>
                        <h1 style="font-size: 28px; margin-bottom: 15px; text-align: center;">Activation Successful!</h1>
                        <p style="font-size: 16px; opacity: 0.9; text-align: center; margin-bottom: 40px; line-height: 1.6;">Your YUP credit card has been successfully activated. You can now start using your card.</p>
                        <button class="btn-primary" style="max-width: 300px;" onclick="renderMobileApp('home')">Get Started</button>
                    </div>
                `;
            } else if (page === 'verification') {
                html = `
                    <div style="background: linear-gradient(135deg, #0a2540 0%, #1a365d 100%); height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; color: #fff;">
                        <div style="width: 200px; height: 200px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 30px; position: relative;">
                            <div style="width: 150px; height: 150px; border: 2px solid rgba(255,255,255,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 700; color: #fff; text-transform: uppercase;">JD</div>
                            <div style="position: absolute; bottom: 20px; right: 20px; width: 40px; height: 40px; background: #d4af37; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; color: #0a2540;">CAM</div>
                        </div>
                        <h1 style="font-size: 24px; margin-bottom: 15px; text-align: center;">Face Verification</h1>
                        <p style="font-size: 14px; opacity: 0.9; text-align: center; margin-bottom: 30px; line-height: 1.6;">Please position your face within the frame and look directly at the camera.</p>
                        <div style="display: flex; gap: 15px;">
                            <button style="padding: 12px 30px; background: rgba(255,255,255,0.2); color: #fff; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button class="btn-primary" style="max-width: 200px;">Start Verification</button>
                        </div>
                    </div>
                `;
            }

            phoneContent.innerHTML = html;
            if (bottomNav) {
                bottomNav.innerHTML = navHtml || `
                    <div class="nav-item">
                        <div class="nav-icon">üè†</div>
                        <div class="nav-label">Home</div>
                    </div>
                    <div class="nav-item">
                        <div class="nav-icon">üì∑</div>
                        <div class="nav-label">QR</div>
                    </div>
                    <div class="nav-item">
                        <div class="nav-icon">P</div>
                        <div class="nav-label">Profile</div>
                    </div>
                `;
            }
        }

        function navigateTo(page) {
            renderMobileApp(page);
        }

        function processPayment() {
            // Simulate payment processing
            alert('Payment processing...');
        }

        function useVoucher() {
            // Simulate voucher usage
            alert('Voucher applied!');
        }

        function updateIntentMetrics() {
            // Calculate metrics based on current journey progress
            const totalEvents = currentUserJourney.length;
            const completedEvents = Math.min(currentEventIndex + 1, totalEvents);
            const progress = totalEvents > 0 ? completedEvents / totalEvents : 0;
            const currentEvents = currentUserJourney.slice(0, completedEvents);

            // Get user features if available
            const userIds = Object.keys(userJourneys);
            const currentUserId = userIds[currentUserIndex];
            const userFeature = userFeatures[currentUserId];

            // Calculate exploration score (unique events / total events)
            const uniqueEvents = new Set(currentEvents.map(e => {
                const parts = e.event_name.split('_');
                return parts.length > 0 ? parts[0] : e.event_name;
            })).size;
            intentMetrics.explorationScore = totalEvents > 0 ? uniqueEvents / totalEvents : 0;
            
            // Use actual feature if available, otherwise calculate
            if (userFeature && progress > 0.5) {
                intentMetrics.explorationScore = userFeature.exploration_score || intentMetrics.explorationScore;
            }

            // Calculate execution score (payment-related events / total events)
            const paymentEvents = currentEvents.filter(e => {
                const name = e.event_name.toLowerCase();
                return name.includes('payment') || name.includes('checkout') || 
                       name.includes('pay') || name.includes('recharge');
            }).length;
            intentMetrics.executionScore = totalEvents > 0 ? paymentEvents / totalEvents : 0;
            
            // Use actual feature if available
            if (userFeature && progress > 0.5) {
                intentMetrics.executionScore = userFeature.execution_score || intentMetrics.executionScore;
            }

            // Calculate event density (events per minute)
            if (currentEvents.length > 1 && currentEvents[0].time_offset !== undefined) {
                const timeSpan = currentEvents[currentEvents.length - 1].time_offset - currentEvents[0].time_offset;
                intentMetrics.eventDensity = timeSpan > 0 ? (currentEvents.length / (timeSpan / 60)) : 0;
            } else {
                intentMetrics.eventDensity = progress * 2.5; // Simulated value
            }

            // Calculate repetitive score (repeated events)
            const eventNames = currentEvents.map(e => e.event_name);
            const repeated = eventNames.filter((e, i) => eventNames.indexOf(e) !== i).length;
            intentMetrics.repetitiveScore = eventNames.length > 0 ? repeated / eventNames.length : 0;

            // Render metrics
            const metricsHtml = `
                <div class="metric-card ${intentMetrics.explorationScore > 0.4 ? 'high' : intentMetrics.explorationScore > 0.2 ? 'medium' : 'low'}">
                    <div class="metric-label">Exploration Score</div>
                    <div class="metric-value">${(intentMetrics.explorationScore * 100).toFixed(1)}%</div>
                </div>
                <div class="metric-card ${intentMetrics.executionScore > 0.15 ? 'high' : intentMetrics.executionScore > 0.05 ? 'medium' : 'low'}">
                    <div class="metric-label">Execution Score</div>
                    <div class="metric-value">${(intentMetrics.executionScore * 100).toFixed(1)}%</div>
                </div>
                <div class="metric-card ${intentMetrics.eventDensity > 2 ? 'high' : intentMetrics.eventDensity > 0.5 ? 'medium' : 'low'}">
                    <div class="metric-label">Event Density</div>
                    <div class="metric-value">${intentMetrics.eventDensity.toFixed(2)}</div>
                </div>
                <div class="metric-card ${intentMetrics.repetitiveScore > 0.5 ? 'high' : intentMetrics.repetitiveScore > 0.2 ? 'medium' : 'low'}">
                    <div class="metric-label">Repetitive Score</div>
                    <div class="metric-value">${(intentMetrics.repetitiveScore * 100).toFixed(1)}%</div>
                </div>
            `;
            document.getElementById('intentMetrics').innerHTML = metricsHtml;

            // Update intent type
            let intentType = 'Exploration Intent';
            let description = 'User is exploring features, browsing multiple functions';
            
            if (intentMetrics.executionScore > intentMetrics.explorationScore * 1.3) {
                intentType = 'Transaction Intent';
                description = 'User shows strong transaction intent with clear payment goals';
            } else if (intentMetrics.repetitiveScore > 0.5) {
                intentType = 'Hesitant Intent';
                description = 'User shows hesitation with repeated actions, may need guidance';
            } else if (intentMetrics.explorationScore > 0.4) {
                intentType = 'Exploration Intent';
                description = 'User is actively exploring different features and options';
            }

            document.getElementById('intentType').innerHTML = `
                <h3>Current Intent Type</h3>
                <div class="type-name">${intentType}</div>
                <div class="type-description">${description}</div>
            `;

            // Check for pain points
            checkPainPoints();
        }

        function checkPainPoints() {
            const painPointAlert = document.getElementById('painPointAlert');
            const solutionCard = document.getElementById('solutionCard');
            
            // Reset
            painPointAlert.classList.remove('show');
            solutionCard.classList.remove('show');

            // Check for high repetitive score (hesitation)
            if (intentMetrics.repetitiveScore > 0.5 && currentEventIndex > 5) {
                painPointAlert.innerHTML = `
                    <h4>Pain Point Detected: User Hesitation</h4>
                    <p>User is showing repetitive behavior (${(intentMetrics.repetitiveScore * 100).toFixed(1)}% repetitive actions), indicating confusion or hesitation in the payment process.</p>
                `;
                painPointAlert.classList.add('show');

                solutionCard.innerHTML = `
                    <h4>Automated Solution</h4>
                    <ul class="solution-list">
                        <li>Show simplified payment flow guide</li>
                        <li>Highlight "Quick Pay" option for faster checkout</li>
                        <li>Display customer support chat button</li>
                        <li>Offer one-click payment for returning users</li>
                    </ul>
                `;
                solutionCard.classList.add('show');
            }
            // Check for low execution score (exploration without action)
            else if (intentMetrics.executionScore < 0.1 && intentMetrics.explorationScore > 0.3 && currentEventIndex > 10) {
                painPointAlert.innerHTML = `
                    <h4>Pain Point Detected: Low Conversion Intent</h4>
                    <p>User is exploring features (${(intentMetrics.explorationScore * 100).toFixed(1)}% exploration) but shows low transaction intent (${(intentMetrics.executionScore * 100).toFixed(1)}% execution), indicating potential conversion barrier.</p>
                `;
                painPointAlert.classList.add('show');

                solutionCard.innerHTML = `
                    <h4>Automated Solution</h4>
                    <ul class="solution-list">
                        <li>Display limited-time promotion banner</li>
                        <li>Show personalized voucher recommendations</li>
                        <li>Trigger "First Transaction Bonus" notification</li>
                        <li>Provide step-by-step transaction tutorial</li>
                    </ul>
                `;
                solutionCard.classList.add('show');
            }
            // Check for high event density (rushed behavior)
            else if (intentMetrics.eventDensity > 3 && currentEventIndex > 5) {
                painPointAlert.innerHTML = `
                    <h4>Pain Point Detected: High Urgency Behavior</h4>
                    <p>User shows high event density (${intentMetrics.eventDensity.toFixed(2)} events/min), indicating urgent need but potential confusion in navigation.</p>
                `;
                painPointAlert.classList.add('show');

                solutionCard.innerHTML = `
                    <h4>Automated Solution</h4>
                    <ul class="solution-list">
                        <li>Simplify navigation with prominent "Pay Now" button</li>
                        <li>Reduce form fields to essential information only</li>
                        <li>Enable auto-fill for faster checkout</li>
                        <li>Show progress indicator for transaction steps</li>
                    </ul>
                `;
                solutionCard.classList.add('show');
            }
        }

        function renderJourneyTimeline() {
            const timeline = document.getElementById('journeyTimeline');
            if (!timeline) {
                console.error('Timeline element not found');
                return;
            }
            
            if (!currentUserJourney || currentUserJourney.length === 0) {
                timeline.innerHTML = '<div style="padding: 20px; text-align: center; color: #64748b;">No journey data available</div>';
                return;
            }
            
            let html = '';
            console.log(`Rendering timeline with ${currentUserJourney.length} events`);

            currentUserJourney.forEach((event, index) => {
                const isActive = index === currentEventIndex;
                const isCompleted = index < currentEventIndex;
                const eventName = event.event_name ? event.event_name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'Unknown Event';
                
                // Format time
                let eventTime = '';
                if (event.event_time) {
                    eventTime = new Date(event.event_time).toLocaleTimeString();
                } else if (event.time_offset !== undefined) {
                    const minutes = Math.floor(event.time_offset / 60);
                    const seconds = Math.floor(event.time_offset % 60);
                    eventTime = `+${minutes}m ${seconds}s`;
                } else {
                    eventTime = `Event ${index + 1}`;
                }

                html += `
                    <div class="timeline-item ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}">
                        <div class="timeline-icon">${index + 1}</div>
                        <div class="timeline-content">
                            <div class="timeline-event">${eventName}</div>
                            <div class="timeline-time">${eventTime}</div>
                        </div>
                    </div>
                `;
            });

            timeline.innerHTML = html;
            console.log(`Timeline rendered with ${currentUserJourney.length} items`);
            
            // Add click and hover event listeners to timeline items
            const timelineItems = timeline.querySelectorAll('.timeline-item');
            timelineItems.forEach((item, index) => {
                // Hover effect
                item.addEventListener('mouseenter', function(e) {
                    this.style.cursor = 'pointer';
                });
                
                // Click effect
                item.addEventListener('click', function(e) {
                    // Remove clicked class from all items
                    timelineItems.forEach(i => i.classList.remove('clicked'));
                    // Add clicked class to current item
                    this.classList.add('clicked');
                    
                    // Jump to this event
                    if (index !== currentEventIndex) {
                        pauseDemo();
                        currentEventIndex = index;
                        updateDemo();
                    }
                    
                    // Show click effect in mobile app
                    showMobileClick(e, index);
                });
            });
        }
        
        // Show highlight box for component related to current event
        function showMobileClick(event, eventIndex) {
            const phoneContent = document.getElementById('phoneContent');
            
            if (!phoneContent) {
                return;
            }
            
            // Remove any existing highlight
            const existingHighlight = phoneContent.querySelector('.interaction-highlight');
            if (existingHighlight) {
                existingHighlight.remove();
            }
            
            // Wait a bit for DOM to update
            setTimeout(() => {
                // Get all interactive elements in mobile app
                const allElements = phoneContent.querySelectorAll('*');
                const clickableElements = phoneContent.querySelectorAll('button, .card, .menu-item, .nav-item, .voucher-card, .task-item, .action-btn, .quick-action, .home-card, .profile-item, .btn-primary, .floating-btn, a, .task-card, .voucher-item, .app-header, .credit-card, .new-user-zone, .quick-actions, .tasks-section, .bottom-nav, .payment-amount, .voucher-list, .qr-scanner, .profile-header, .settings-item');
                
                if (clickableElements.length > 0 || allElements.length > 0) {
                    // Get current event
                    const currentEvent = currentUserJourney[eventIndex];
                    const eventName = currentEvent ? currentEvent.event_name.toLowerCase() : '';
                    
                    let targetElement = null;
                    let matchScore = 0;
                    
                    // Enhanced matching logic - check all elements
                    for (let elem of allElements) {
                        const elemText = elem.textContent.toLowerCase();
                        const elemClasses = elem.className.toLowerCase();
                        const elemId = elem.id ? elem.id.toLowerCase() : '';
                        let score = 0;
                        
                        // Home page related
                        if (eventName.includes('home') || eventName.includes('homepage')) {
                            if (elemClasses.includes('home') || elemText.includes('home') || elemId.includes('home') || 
                                elemClasses.includes('app-header') || elemClasses.includes('credit-card') ||
                                elemClasses.includes('new-user-zone') || elemClasses.includes('quick-actions') ||
                                elemClasses.includes('tasks-section')) {
                                score = 10;
                            }
                        }
                        
                        // Payment related
                        if (eventName.includes('payment') || eventName.includes('pay') || eventName.includes('checkout')) {
                            if (elemClasses.includes('payment') || elemText.includes('pay') || elemText.includes('checkout') ||
                                elemClasses.includes('btn-primary') || elemClasses.includes('payment-amount') ||
                                elemId.includes('payment') || elemId.includes('checkout')) {
                                score = 10;
                            }
                        }
                        
                        // Voucher related
                        if (eventName.includes('voucher')) {
                            if (elemClasses.includes('voucher') || elemText.includes('voucher') ||
                                elemClasses.includes('voucher-card') || elemClasses.includes('voucher-list') ||
                                elemId.includes('voucher')) {
                                score = 10;
                            }
                        }
                        
                        // QR/Scan related
                        if (eventName.includes('qr') || eventName.includes('scan') || eventName.includes('camera')) {
                            if (elemClasses.includes('qr') || elemText.includes('scan') || elemText.includes('qr') ||
                                elemText.includes('camera') || elemClasses.includes('qr-scanner') ||
                                elemId.includes('qr') || elemId.includes('scan')) {
                                score = 10;
                            }
                        }
                        
                        // Profile related
                        if (eventName.includes('profile')) {
                            if (elemClasses.includes('profile') || elemText.includes('profile') ||
                                elemClasses.includes('profile-header') || elemClasses.includes('profile-item') ||
                                elemClasses.includes('settings-item') || elemId.includes('profile')) {
                                score = 10;
                            }
                        }
                        
                        // Task related
                        if (eventName.includes('task')) {
                            if (elemClasses.includes('task') || elemText.includes('task') ||
                                elemClasses.includes('task-item') || elemClasses.includes('task-card') ||
                                elemClasses.includes('tasks-section') || elemId.includes('task')) {
                                score = 10;
                            }
                        }
                        
                        // Activation related
                        if (eventName.includes('activate') || eventName.includes('activation')) {
                            if (elemText.includes('activate') || elemClasses.includes('activate') ||
                                elemId.includes('activate')) {
                                score = 10;
                            }
                        }
                        
                        // Face verification related
                        if (eventName.includes('face') || eventName.includes('verification') || eventName.includes('verify')) {
                            if (elemText.includes('face') || elemText.includes('verify') || elemText.includes('verification') ||
                                elemClasses.includes('face') || elemClasses.includes('verify') ||
                                elemId.includes('face') || elemId.includes('verify')) {
                                score = 10;
                            }
                        }
                        
                        // Navigation related
                        if (eventName.includes('nav') || eventName.includes('navigation') || eventName.includes('bottom')) {
                            if (elemClasses.includes('nav') || elemClasses.includes('bottom-nav') ||
                                elemClasses.includes('nav-item') || elemId.includes('nav')) {
                                score = 10;
                            }
                        }
                        
                        // Floating button related
                        if (eventName.includes('floating') || eventName.includes('float')) {
                            if (elemClasses.includes('floating') || elemClasses.includes('floating-btn') ||
                                elemId.includes('floating')) {
                                score = 10;
                            }
                        }
                        
                        // Popup related
                        if (eventName.includes('popup') || eventName.includes('fullpopup')) {
                            // Look for popup-like elements
                            if (elemClasses.includes('popup') || elemClasses.includes('modal') ||
                                elemClasses.includes('dialog') || elemId.includes('popup')) {
                                score = 10;
                            }
                        }
                        
                        // If this element has a higher score, use it
                        if (score > matchScore) {
                            matchScore = score;
                            targetElement = elem;
                        }
                    }
                    
                    // Fallback: try to find by text content similarity
                    if (!targetElement && eventName) {
                        for (let elem of clickableElements) {
                            const elemText = elem.textContent.toLowerCase();
                            const keywords = eventName.split(/[_\s]+/);
                            let matchCount = 0;
                            
                            for (let keyword of keywords) {
                                if (keyword.length > 2 && elemText.includes(keyword)) {
                                    matchCount++;
                                }
                            }
                            
                            if (matchCount > 0 && matchCount > keywords.length * 0.3) {
                                targetElement = elem;
                                break;
                            }
                        }
                    }
                    
                    // Final fallback: use index-based selection
                    if (!targetElement && clickableElements.length > 0) {
                        const elementIndex = Math.min(eventIndex % clickableElements.length, clickableElements.length - 1);
                        targetElement = clickableElements[elementIndex];
                    }
                    
                    if (targetElement) {
                        const rect = targetElement.getBoundingClientRect();
                        const phoneRect = phoneContent.getBoundingClientRect();
                        
                        // Skip if element is not visible
                        if (rect.width === 0 || rect.height === 0) {
                            return;
                        }
                        
                        // Calculate position and size relative to phone content
                        const left = rect.left - phoneRect.left - 4;
                        const top = rect.top - phoneRect.top - 4;
                        const width = rect.width + 8;
                        const height = rect.height + 8;
                        
                        // Create highlight box
                        const highlight = document.createElement('div');
                        highlight.className = 'interaction-highlight';
                        highlight.style.left = left + 'px';
                        highlight.style.top = top + 'px';
                        highlight.style.width = width + 'px';
                        highlight.style.height = height + 'px';
                        
                        phoneContent.appendChild(highlight);
                        
                        // Add click animation after a brief delay
                        setTimeout(() => {
                            highlight.classList.add('clicking');
                            setTimeout(() => {
                                highlight.classList.remove('clicking');
                            }, 400);
                        }, 200);
                        
                        // Keep highlight visible longer (3 seconds) for better visibility
                        setTimeout(() => {
                            if (highlight.parentNode) {
                                highlight.style.opacity = '0';
                                highlight.style.transition = 'opacity 0.5s ease';
                                setTimeout(() => {
                                    if (highlight.parentNode) {
                                        highlight.remove();
                                    }
                                }, 500);
                            }
                        }, 3000);
                    }
                }
            }, 300);
        }
        
        // Track mouse movement in timeline for hover preview
        function initTimelineHoverTracking() {
            const timeline = document.getElementById('journeyTimeline');
            if (!timeline) return;
            
            timeline.addEventListener('mousemove', function(e) {
                const items = timeline.querySelectorAll('.timeline-item');
                items.forEach(item => {
                    const rect = item.getBoundingClientRect();
                    const isHovering = e.clientX >= rect.left && e.clientX <= rect.right &&
                                      e.clientY >= rect.top && e.clientY <= rect.bottom;
                    
                    if (isHovering) {
                        item.style.borderLeftColor = '#8b5cf6';
                        item.style.boxShadow = '0 4px 12px rgba(139, 92, 246, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.9)';
                    }
                });
            });
            
            timeline.addEventListener('mouseleave', function() {
                const items = timeline.querySelectorAll('.timeline-item');
                items.forEach(item => {
                    if (!item.classList.contains('active')) {
                        item.style.borderLeftColor = '';
                        item.style.boxShadow = '';
                    }
                });
            });
        }

        function setPlaybackSpeed(speed) {
            playbackSpeed = speed;
            
            // Update active button
            document.querySelectorAll('.speed-btn').forEach(btn => {
                if (parseFloat(btn.getAttribute('data-speed')) === speed) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // If currently playing, restart with new speed
            if (isPlaying) {
                pauseDemo();
                setTimeout(() => {
                    startDemo();
                }, 100);
            }
        }
        
        function startDemo() {
            if (isPlaying) return;
            
            isPlaying = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;

            function playNextEvent() {
                if (currentEventIndex < currentUserJourney.length - 1) {
                    currentEventIndex++;
                    updateDemo();
                    
                    // Calculate delay based on time offset if available
                    let delay = 2000; // Default 2 seconds
                    if (currentEventIndex < currentUserJourney.length) {
                        const currentEvent = currentUserJourney[currentEventIndex];
                        const prevEvent = currentUserJourney[currentEventIndex - 1];
                        
                        if (currentEvent.time_offset !== undefined && prevEvent.time_offset !== undefined) {
                            const timeDiff = (currentEvent.time_offset - prevEvent.time_offset) * 1000; // Convert to ms
                            delay = Math.max(500, Math.min(timeDiff, 5000)); // Clamp between 0.5s and 5s
                        }
                    }
                    
                    // Apply playback speed
                    delay = delay / playbackSpeed;
                    
                    playInterval = setTimeout(playNextEvent, delay);
                } else {
                    pauseDemo();
                }
            }
            
            playNextEvent();
        }

        function pauseDemo() {
            isPlaying = false;
            if (playInterval) {
                clearTimeout(playInterval);
                playInterval = null;
            }
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function resetDemo() {
            pauseDemo();
            currentEventIndex = 0;
            updateDemo();
            resetControls();
        }

        function resetControls() {
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        function updateDemo() {
            // Update progress
            const progress = currentUserJourney.length > 0 ? (currentEventIndex + 1) / currentUserJourney.length * 100 : 0;
            document.getElementById('progressFill').style.width = progress + '%';

            // Update mobile app based on current event
            if (currentEventIndex < currentUserJourney.length) {
                const currentEvent = currentUserJourney[currentEventIndex];
                const eventName = currentEvent.event_name;
                renderMobileApp(null, eventName);
                
                // Show highlight box for component related to this event
                // Use longer delay to ensure DOM is fully rendered
                setTimeout(() => {
                    showMobileClick(null, currentEventIndex);
                }, 500);
            }

            // Update intent metrics
            updateIntentMetrics();
            
            // Update risk radar
            updateRiskRadar();

            // Update timeline
            renderJourneyTimeline();
            
            // Re-initialize hover tracking
            setTimeout(() => {
                initTimelineHoverTracking();
            }, 100);

            // Note: Removed auto-scroll to timeline to allow users to view other sections
            // Users can manually scroll to timeline if needed
        }

        // Calculate risk score dynamically based on current journey progress
        function calculateCurrentRiskScore() {
            if (currentUserJourney.length === 0) return { score: 0, factors: {} };
            
            const userIds = Object.keys(userJourneys);
            const currentUserId = userIds[currentUserIndex];
            const completedEvents = currentUserJourney.slice(0, currentEventIndex + 1);
            
            // Try to get pre-calculated risk score
            if (userRiskScores[currentUserId]) {
                const baseRisk = userRiskScores[currentUserId];
                // Adjust based on progress
                const progress = (currentEventIndex + 1) / currentUserJourney.length;
                return {
                    score: baseRisk.risk_score * progress,
                    factors: baseRisk.risk_factors,
                    total: baseRisk.risk_score
                };
            }
            
            // Calculate dynamically
            const riskFactors = {
                'High Repetition': 0,
                'Rapid Switching': 0,
                'Long Idle': 0,
                'Failed Attempts': 0,
                'Unusual Pattern': 0,
                'High Urgency': 0
            };
            
            const totalEvents = completedEvents.length;
            if (totalEvents === 0) return { score: 0, factors: riskFactors };
            
            // 1. High repetition
            const eventCounts = {};
            completedEvents.forEach(e => {
                eventCounts[e.event_name] = (eventCounts[e.event_name] || 0) + 1;
            });
            const maxRepeat = Math.max(...Object.values(eventCounts));
            riskFactors['High Repetition'] = Math.min(30, (maxRepeat / totalEvents) * 100);
            
            // 2. Rapid switching / Low diversity
            const uniqueEvents = new Set(completedEvents.map(e => e.event_name)).size;
            if (totalEvents > 0 && uniqueEvents / totalEvents < 0.3) {
                riskFactors['Rapid Switching'] = Math.min(20, (1 - uniqueEvents/totalEvents) * 40);
            }
            
            // 3. Failed attempts (payment without completion)
            const paymentEvents = completedEvents.filter(e => 
                e.event_name.toLowerCase().includes('payment') || 
                e.event_name.toLowerCase().includes('checkout') ||
                e.event_name.toLowerCase().includes('pay') ||
                e.event_name.toLowerCase().includes('recharge')
            );
            if (paymentEvents.length > 2) {
                riskFactors['Failed Attempts'] = Math.min(30, paymentEvents.length * 8);
            }
            
            // 4. High urgency (very high event density)
            if (completedEvents.length > 1 && completedEvents[0].time_offset !== undefined) {
                const timeSpan = completedEvents[completedEvents.length - 1].time_offset - completedEvents[0].time_offset;
                if (timeSpan > 0) {
                    const eventDensity = (completedEvents.length / (timeSpan / 60));
                    if (eventDensity > 5) {
                        riskFactors['High Urgency'] = Math.min(25, (eventDensity - 5) * 5);
                    }
                }
            }
            
            // 5. Unusual pattern (many homepage returns)
            const homepageEvents = completedEvents.filter(e => 
                e.event_name.toLowerCase().includes('home') || 
                e.event_name.toLowerCase().includes('homepage')
            );
            if (homepageEvents.length > totalEvents * 0.3) {
                riskFactors['Unusual Pattern'] = Math.min(20, (homepageEvents.length / totalEvents) * 50);
            }
            
            const totalRisk = Math.min(100, Object.values(riskFactors).reduce((a, b) => a + b, 0));
            return { score: totalRisk, factors: riskFactors };
        }

        // Update risk radar chart
        function updateRiskRadar() {
            const riskData = calculateCurrentRiskScore();
            const riskScore = riskData.score;
            const riskFactors = riskData.factors;
            
            // Determine risk level
            let riskLevel = 'Normal Consultation';
            let riskColor = '#28a745';
            let indicatorColor = '#28a745';
            
            if (riskScore >= 60) {
                riskLevel = 'High Risk (Manual Intervention)';
                riskColor = '#dc3545';
                indicatorColor = '#dc3545';
            } else if (riskScore >= 20) {
                riskLevel = 'Potential Risk';
                riskColor = '#ffc107';
                indicatorColor = '#ffc107';
            }
            
            // Update display
            document.getElementById('riskScoreDisplay').textContent = `Risk Score: ${riskScore.toFixed(1)}`;
            document.getElementById('riskLevelDisplay').textContent = `Level: ${riskLevel}`;
            
            const indicator = document.getElementById('riskIndicator');
            indicator.textContent = Math.round(riskScore);
            indicator.style.background = indicatorColor;
            
            // Prepare radar chart data
            const radarCategories = Object.keys(riskFactors);
            const radarValues = Object.values(riskFactors);
            
            // Normalize values to 0-100 scale for radar
            const maxValue = Math.max(...radarValues, 1);
            const normalizedValues = radarValues.map(v => (v / maxValue) * 100);
            
            // Create radar chart
            const radarData = [{
                type: 'scatterpolar',
                r: normalizedValues,
                theta: radarCategories,
                fill: 'toself',
                name: 'Risk Factors',
                line: {
                    color: riskColor,
                    width: 2
                },
                fillcolor: riskColor.replace(')', ', 0.2)').replace('rgb', 'rgba'),
                marker: {
                    color: riskColor,
                    size: 8
                }
            }];
            
            const radarLayout = {
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 100],
                        tickfont: { size: 10 },
                        tickmode: 'linear',
                        tick0: 0,
                        dtick: 25
                    },
                    angularaxis: {
                        tickfont: { size: 11 },
                        rotation: 90
                    }
                },
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                margin: { t: 20, b: 20, l: 20, r: 20 },
                height: 400
            };
            
            const radarConfig = {
                displayModeBar: false,
                responsive: true
            };
            
            Plotly.newPlot('riskRadarChart', radarData, radarLayout, radarConfig);
        }

        // Initialize on load
        window.addEventListener('load', () => {
            loadUserJourneys();
            // Initialize timeline hover tracking
            setTimeout(() => {
                initTimelineHoverTracking();
            }, 500);
            
            // Initialize playback speed to 1x
            setPlaybackSpeed(1);
        });
    </script>
</body>
</html>

